{"version":3,"sources":["ts/arc.ts","ts/midihelper.ts","index.ts"],"names":[],"mappings":"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","file":"src.fa09e347.js","sourceRoot":"../src","sourcesContent":["import {MidiHelper} from './midihelper';\n\n\nexport class Arc {\n  private selector_: string;\n  private mh_: MidiHelper;\n  private element_: HTMLInputElement | null = null;\n  private label_: HTMLElement | null = null;\n  private value_ = 0;\n\n  constructor(selector: string, midiHelper: MidiHelper) {\n    this.selector_ = selector;\n    this.mh_ = midiHelper;\n\n    if (this.selector_) {\n      this.element_ = document.querySelector(this.selector_);\n      this.label_ = document.querySelector(`${this.selector_}-label`);\n    }\n\n    this.attach_();\n  }\n\n  get value(): number {\n    return new Number(this.value_) as number;\n  }\n\n  private attach_() {\n    if (this.element_) {\n      this.element_.addEventListener('input', this.changeListener_.bind(this));\n    }\n  }\n\n  private changeListener_() {\n    const elem = document.querySelector(`${this.selector_}-val1`) as HTMLInputElement;\n    const val1 = new Number(elem.value || 0) as number;\n\n    if (this.element_) {\n      this.value_ = new Number(this.element_.value) as number;\n      if (this.label_ && val1) {\n        this.label_.innerText = `${this.value_} | ${val1}`;\n      }\n\n      // this.mh_.noteOn(this.value, 100, 100);\n      this.mh_.sendMessage(this.mh_.CC, val1, this.value);\n    }\n  }\n}","export class MidiHelper {\n  NOTE_ON = 0x90;\n  NOTE_OFF = 0x80;\n  CC = 0xB0;\n\n  private midiIn_: WebMidi.MIDIInput[] = [];\n  private midiOut_: WebMidi.MIDIOutput[] = [];\n  private selectIn_: HTMLSelectElement | null = null;\n  private selectOut_: HTMLSelectElement | null = null;\n\n  constructor() {\n    this.selectIn_ = document.querySelector('#midi-input');\n    this.selectOut_ = document.querySelector('#midi-output');\n  }\n\n  private midiReady_(midiAccess: WebMidi.MIDIAccess) {\n    midiAccess.addEventListener('statechange', () => {\n      this.initDevices_(midiAccess);\n    });\n    this.initDevices_(midiAccess);\n  }\n\n  private initDevices_(midiAccess: WebMidi.MIDIAccess) {\n    this.midiIn_ = [];\n    this.midiOut_ = [];\n\n    // MIDI devices that send you data.\n    const inputs = midiAccess.inputs.values();\n    for (let input = inputs.next(); input && !input.done; input = inputs.next()) {\n      this.midiIn_.push(input.value);\n    }\n\n    // MIDI devices that you send data to.\n    const outputs = midiAccess.outputs.values();\n    for (let output = outputs.next(); output && !output.done; output = outputs.next()) {\n      this.midiOut_.push(output.value);\n    }\n\n    this.displayDevices_();\n  }\n\n  private displayDevices_() {\n    if (this.selectIn_) {\n      this.selectIn_.innerHTML = this.midiIn_.map((device: any) => {\n        `<option>${device.name}</option>`\n      }).join('');\n    }\n\n    if (this.selectOut_) {\n      this.selectOut_.innerHTML = this.midiOut_.map((device: any) => {\n        `<option>${device.name}</option>`\n      }).join('');\n    }\n  }\n\n  async connect() {\n    await (navigator as Navigator)\n    .requestMIDIAccess()\n    .then(\n        (midiAccess: WebMidi.MIDIAccess) => this.midiReady_(midiAccess),\n        (err: Error) => console.log('Something went wrong', err));\n  }\n\n  noteOn(pitch: number, velocity: number) {\n    const msgOn = [this.NOTE_ON, pitch, velocity];\n\n    if (this.selectOut_) {\n      const device: WebMidi.MIDIOutput = this.midiOut_[this.selectOut_.selectedIndex];\n      device.send(msgOn);\n    }\n  }\n\n  noteOff(pitch: number, duration: number) {\n    const msgOff = [this.NOTE_ON, pitch, 0];\n\n    if (this.selectOut_) {\n      const device: WebMidi.MIDIOutput = this.midiOut_[this.selectOut_.selectedIndex];\n      device.send(msgOff, Date.now() + duration);\n    }\n  }\n\n  sendMessage(msg: number, value1: number, value2: number) {\n    if (this.selectOut_) {\n      const device: WebMidi.MIDIOutput = this.midiOut_[this.selectOut_.selectedIndex];\n      device.send([msg, value1, value2]);\n    }\n  }\n}","import {Arc} from './ts/arc';\nimport {MidiHelper} from './ts/midihelper';\n\n// // Instatiate control elements.\n// // TODO (frederickk) In the real world, this would be handled by template logic.\n// const container = document.querySelector('#container');\n// for (let i = 0; i < 8; i++) {\n//   let htmlStr = `\n//   <div class=\"arc__container\">\n//     <div id=\"arc${i + 1}-name\" class=\"arc__label arc__label--white\" data-save=\"1\" contenteditable=\"true\">Arc ${i + 1}</div>\n//     <div id=\"arc${i + 1}-val1-label\" class=\"arc__label\">CC Number</div>\n//     <input id=\"arc${i + 1}-val1\" class=\"arc__input\" data-save=\"1\" value=\"${i + 1}\" />\n//     <label id=\"arc${i + 1}-label\" class=\"arc__label\" for=\"arc${i + 1}\">0 | ${i + 1}</label>\n//     <input id=\"arc${i + 1}\" name=\"arc${i + 1}\" class=\"arc\" data-save=\"1\" type=\"range\" value=\"0\" max=\"127\" />\n//   </div>`;\n//   container.innerHTML += htmlStr;\n// }\n\nexport class WebmidiController {\n  private saveButton_: HTMLInputElement | null = null;\n  private clearButton_: HTMLInputElement | null = null;\n\n  constructor() {\n    this.saveButton_ = document.querySelector('#save-button');\n    this.clearButton_ = document.querySelector('#clear-button');\n\n    // Instantiate webmidi.\n    const mh = new MidiHelper();\n    mh.connect();\n\n    // Instatiate sliders.\n    document.querySelectorAll('.arc').forEach((arc) => {\n      new Arc(`#${arc.id}`, mh);\n    });\n\n    this.fetchState();\n    this.attach_();\n  }\n\n  saveState() {\n    console.log('Saving state in localStorage');\n    const saves = document.querySelectorAll('*[data-save]');\n    saves.forEach((item: any) => {\n      this.localStorageSaveHandler_(item);\n    });\n  }\n\n  // Reinstate save state.\n  fetchState() {\n    const saves = document.querySelectorAll('*[data-save]');\n\n    saves.forEach((item: any) => {\n      const eventType = (item.innerText)\n        ? 'input'\n        : 'change';\n      item.addEventListener(eventType, () => {\n        this.localStorageSaveHandler_(item);\n      });\n\n      const state = localStorage.getItem(item.id);\n      if (state) {\n        if (item.value) {\n          item.value = state;\n        } else if (item.innerText) {\n          item.innerText = state;\n        }\n      } else {\n        this.localStorageSaveHandler_(item);\n      }\n    });\n  }\n\n  private attach_() {\n    if (this.clearButton_) {\n      this.clearButton_.addEventListener('click', () => {\n        console.log('Clearing saved localStorage states');\n        localStorage.clear();\n      });\n    }\n\n    if (this.saveButton_) {\n      this.saveButton_.addEventListener('click', this.saveState.bind(this));\n    }\n  }\n\n  private localStorageSaveHandler_(item: any) {\n    localStorage.setItem(item.id, item.value || item.innerText);\n  }\n}\n\nnew WebmidiController();"]}